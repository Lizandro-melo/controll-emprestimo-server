// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Tipo_User {
  MASTER
  ADMIN
  OPERADOR
}

enum Status_auth {
  ATIVO
  INATIVO
  INADIMPLENTE
}

//register
model register_token {
  uuid      String    @id @unique @default(uuid())
  status    Boolean   @default(true)
  data_util DateTime?
}

//Session autenticação
model auth {
  uuid     String      @id @unique @default(uuid())
  role     Tipo_User   @default(OPERADOR)
  status   Status_auth @default(ATIVO)
  id_sub   String?
  id_asaas String?

  historico_session historico_session[]
  historico_otp     historico_otp[]
  historico_senha   historico_senha[]
  operador          operador[]
}

model historico_session {
  uuid         String   @id @unique @default(uuid())
  uuid_auth    String
  record_login DateTime @default(now())
  expira_time  DateTime
  auth         auth     @relation(fields: [uuid_auth], references: [uuid])
}

model historico_otp {
  uuid          String   @id
  code_otp      String
  record_create DateTime @default(now())
  auth          auth     @relation(fields: [uuid], references: [uuid])
}

model historico_senha {
  uuid          String   @id
  senha         String
  record_update DateTime @default(now())
  status        Boolean  @default(true)
  auth          auth     @relation(fields: [uuid], references: [uuid])
}

model operador {
  uuid               String              @id
  nome_completo      String
  num_cpf            String              @unique
  num_cnpj           String?
  data_nascimento    DateTime?
  correio_eletronico String?
  telefone_operador  telefone_operador[]
  endereco_operador  endereco_operador[]
  auth               auth                @relation(fields: [uuid], references: [uuid])
  clientes           cliente[]
  emprestimos        emprestimo[]
}

model telefone_operador {
  id            Int      @id @default(autoincrement())
  num_cel       String   @unique
  status        Boolean  @default(true)
  uuid_operador String
  operador      operador @relation(fields: [uuid_operador], references: [uuid])
}

model endereco_operador {
  id                 Int      @id @default(autoincrement())
  codigo_postal      String
  numero_residencial String
  status             Boolean  @default(true)
  uuid_operador      String
  operador           operador @relation(fields: [uuid_operador], references: [uuid])
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////

// // SISTEMA

enum Redes {
  WHATSAPP
  TELEGRAM
  FACEBOOK
  LINKEDIN
  URL
}

enum Status_divida {
  PENDENTE
  PAGO
}

enum Tipo_pagamento {
  PIX
  BOLETO
  CRED
  DEB
  DINHEIRO
}

enum Tipo_cobranca {
  ANUAL
  MENSAL
  SEMANAL
  DIARIO
}

model cliente {
  uuid               String             @id @unique @default(uuid())
  nome_completo      String
  num_cpf            String
  num_cnpj           String?
  data_nascimento    DateTime?
  correio_eletronico String?
  observacao         String?
  uuid_operador      String
  status             Boolean            @default(true)
  operador           operador           @relation(fields: [uuid_operador], references: [uuid])
  emprestimos        emprestimo[]
  redeSocials        rede_social[]
  telefoneClientes   telefone_cliente[]
  enderecoClientes   endereco_cliente[]
}

model configuracao {
  id                Int @id @default(autoincrement())
  alerta_dias_antes Int
  senha_entrada     Int
}

model rede_social {
  id           Int     @id @unique @default(autoincrement())
  uuid_cliente String
  url          String
  tipo_rede    Redes
  cliente      cliente @relation(fields: [uuid_cliente], references: [uuid])
}

model telefone_cliente {
  id           Int     @id @default(autoincrement())
  num_cel      String
  status       Boolean @default(true)
  uuid_cliente String
  cliente      cliente @relation(fields: [uuid_cliente], references: [uuid])
}

model endereco_cliente {
  id                 Int     @id @default(autoincrement())
  codigo_postal      String
  numero_residencial String
  status             Boolean @default(true)
  uuid_cliente       String
  cliente            cliente @relation(fields: [uuid_cliente], references: [uuid])
}

model emprestimo {
  uuid             String        @id @unique @default(uuid())
  nome_emprestimo  String
  valor_emprestimo Float
  tipo             Tipo_cobranca
  data_emprestimo  DateTime      @default(now())
  data_final       DateTime
  valor_receber    Float
  observacao       String?
  status           Status_divida @default(PENDENTE)
  uuid_operador    String
  uuid_cliente     String
  pagamentos       pagamento[]
  cliente          cliente       @relation(fields: [uuid_cliente], references: [uuid])
  operador         operador      @relation(fields: [uuid_operador], references: [uuid])
}

model pagamento {
  uuid            String          @id @unique @default(uuid())
  valor_pago      Float?
  valor_previsto  Float
  uuid_emprestimo String
  tipo_pagamento  Tipo_pagamento?
  data_pagamento  DateTime?
  data_vencimento DateTime
  comprovante     String?
  observacao      String?
  status          Status_divida   @default(PENDENTE)
  emprestimo      emprestimo      @relation(fields: [uuid_emprestimo], references: [uuid])
}
